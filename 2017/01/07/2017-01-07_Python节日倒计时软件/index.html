<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  
  <title>Python节日倒计时软件 | orzangleli | 活在梦里的程序员和设计师</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="theme-color" content="#3F51B5">
  
  
  <meta name="keywords" content="python,软件">
  <meta name="description" content="Python 节日倒计时软件制作一. 项目描述本次项目以Python3 作为编程语言，制作一款能够倒计时节日的图形化软件。
1.1 项目动机本次项目的开发动机是：

我想做一个类似于微博上 @古城钟楼 的报时程序，只是我报的时间是节日的倒计时，还想加上 “历史上的今天” 的功能。我关注的一个博主 @新浪无锡 这位小编也会做一个倒计时的话题的微博，我问他是怎么做的，他跟我说他是数出来的，然后我就想帮">
<meta property="og:type" content="article">
<meta property="og:title" content="Python节日倒计时软件">
<meta property="og:url" content="http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/index.html">
<meta property="og:site_name" content="orzangleli">
<meta property="og:description" content="Python 节日倒计时软件制作一. 项目描述本次项目以Python3 作为编程语言，制作一款能够倒计时节日的图形化软件。
1.1 项目动机本次项目的开发动机是：

我想做一个类似于微博上 @古城钟楼 的报时程序，只是我报的时间是节日的倒计时，还想加上 “历史上的今天” 的功能。我关注的一个博主 @新浪无锡 这位小编也会做一个倒计时的话题的微博，我问他是怎么做的，他跟我说他是数出来的，然后我就想帮">
<meta property="og:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-07_17_26_01_daojishi.png">
<meta property="og:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_55_39_qtdesigner.png">
<meta property="og:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_58_33_jiemian.png">
<meta property="og:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_57_44_jiegou.png">
<meta property="og:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_15_12_14_ziyuan.png">
<meta property="og:updated_time" content="2017-01-10T13:55:56.135Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python节日倒计时软件">
<meta name="twitter:description" content="Python 节日倒计时软件制作一. 项目描述本次项目以Python3 作为编程语言，制作一款能够倒计时节日的图形化软件。
1.1 项目动机本次项目的开发动机是：

我想做一个类似于微博上 @古城钟楼 的报时程序，只是我报的时间是节日的倒计时，还想加上 “历史上的今天” 的功能。我关注的一个博主 @新浪无锡 这位小编也会做一个倒计时的话题的微博，我问他是怎么做的，他跟我说他是数出来的，然后我就想帮">
<meta name="twitter:image" content="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-07_17_26_01_daojishi.png">
  
    <link rel="alternative" href="/atom.xml" title="orzangleli" type="application/atom+xml">
  
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <link rel="stylesheet" href="/css/style.css?v=1.2.1">
</head>

<body>
  <div id="loading" class="active"></div>

  <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/assets/avatar.gif">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">orzangleli</h5>
          <a href="mailto:orzangleli@163.com" title="orzangleli@163.com" class="mail">orzangleli@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/hust201010701" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://weibo.com/androidjiqiaogonglue" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>

      <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>orzangleli &copy; 2016 - 2017</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

    </div>
  </div>
</aside>

  <main id="main">
    <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Python节日倒计时软件</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container">
        <h1 class="title">Python节日倒计时软件</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-01-06T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2017-01-07
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/python/">python</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Python-节日倒计时软件制作"><span class="post-toc-number">1.</span> <span class="post-toc-text">Python 节日倒计时软件制作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一-项目描述"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">一. 项目描述</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-项目动机"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">1.1 项目动机</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-知识点"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">1.2 知识点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3-效果截图"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">1.3 效果截图</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、附加依赖安装"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">二、附加依赖安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1-PyQt安装"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">2.1 PyQt安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-1-Windows平台"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">2.1.1 Windows平台</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-2-Linux平台"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">2.1.2 Linux平台</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-requests库安装"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">2.2 requests库安装</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-datetime库"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">2.3 datetime库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-4-BeautifulSoup库"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">2.4 BeautifulSoup库</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、编程实现"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">三、编程实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-datetime使用"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">3.1 datetime使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-requests库"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">3.2 requests库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-Qt界面"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">3.3 Qt界面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-1-Pycharm中PyQt5的配置"><span class="post-toc-number">1.3.3.1.</span> <span class="post-toc-text">3.3.1 Pycharm中PyQt5的配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-2-使用QtDesigner-设计界面"><span class="post-toc-number">1.3.3.2.</span> <span class="post-toc-text">3.3.2 使用QtDesigner 设计界面</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-3-使用QtDesigner-设计界面"><span class="post-toc-number">1.3.3.3.</span> <span class="post-toc-text">3.3.3 使用QtDesigner 设计界面</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-4-打包资源"><span class="post-toc-number">1.3.3.4.</span> <span class="post-toc-text">3.3.4 打包资源</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-5-显示窗口"><span class="post-toc-number">1.3.3.5.</span> <span class="post-toc-text">3.3.5 显示窗口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-6-统计倒计时结果"><span class="post-toc-number">1.3.3.6.</span> <span class="post-toc-text">3.3.6 统计倒计时结果</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四-程序发布"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">四. 程序发布</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-安装PyInstaller"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">4.1 安装PyInstaller</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-打包程序"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">4.2 打包程序</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五-后记"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">五.后记</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-2017-01-07_Python节日倒计时软件" 
  class="post-article article-type-post" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Python节日倒计时软件</h1>
        <div class="post-meta">
            <time datetime="2017-01-06T16:00:00.000Z" itemprop="datePublished" class="post-time">
  2017-01-07
</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/python/">python</a></li></ul>



        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Python-节日倒计时软件制作"><a href="#Python-节日倒计时软件制作" class="headerlink" title="Python 节日倒计时软件制作"></a>Python 节日倒计时软件制作</h1><h2 id="一-项目描述"><a href="#一-项目描述" class="headerlink" title="一. 项目描述"></a>一. 项目描述</h2><p>本次项目以Python3 作为编程语言，制作一款能够倒计时节日的图形化软件。</p>
<h3 id="1-1-项目动机"><a href="#1-1-项目动机" class="headerlink" title="1.1 项目动机"></a>1.1 项目动机</h3><p>本次项目的开发动机是：</p>
<blockquote>
<p>我想做一个类似于微博上 <a href="http://weibo.com/p/1005052493180882/home?profile_ftype=1&amp;is_all=1#_0" target="_blank" rel="external">@古城钟楼</a> 的报时程序，只是我报的时间是节日的倒计时，还想加上 “历史上的今天” 的功能。我关注的一个博主 <a href="http://weibo.com/xinlangwx?refer_flag=1001030101_" target="_blank" rel="external">@新浪无锡</a> 这位小编也会做一个倒计时的话题的微博，我问他是怎么做的，他跟我说他是数出来的，然后我就想帮帮他并且自己也练习练习，于是就想着开发一款这样的软件。<br>同时，也欢迎大家关注我的微博 <a href="http://weibo.com/androidjiqiaogonglue" target="_blank" rel="external">@orzangleli</a></p>
</blockquote>
<h3 id="1-2-知识点"><a href="#1-2-知识点" class="headerlink" title="1.2 知识点"></a>1.2 知识点</h3><ol>
<li>PyQt5库</li>
<li>requests库</li>
<li>datetime库</li>
<li>BeautifulSoup库</li>
</ol>
<h3 id="1-3-效果截图"><a href="#1-3-效果截图" class="headerlink" title="1.3 效果截图"></a>1.3 效果截图</h3><p>默认选中最近一个月的所有传统节日和24节气。</p>
<p><img src="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-07_17_26_01_daojishi.png" alt=""></p>
<h2 id="二、附加依赖安装"><a href="#二、附加依赖安装" class="headerlink" title="二、附加依赖安装"></a>二、附加依赖安装</h2><h3 id="2-1-PyQt安装"><a href="#2-1-PyQt安装" class="headerlink" title="2.1 PyQt安装"></a>2.1 PyQt安装</h3><p>Qt 是一个跨平台的C++应用程序开发框架。广泛用于开发GUI程序，这种情况下又被称为部件工具箱。也可用于开发非GUI程序，比如控制台工具和服务器。</p>
<p>参考：<a href="https://zh.wikipedia.org/wiki/Qt" target="_blank" rel="external">wiki–Qt</a></p>
<h4 id="2-1-1-Windows平台"><a href="#2-1-1-Windows平台" class="headerlink" title="2.1.1 Windows平台"></a>2.1.1 Windows平台</h4><p>首先下载PyQt5,注意不要下载最新版v5.7.1，最新版目前只有源码，没有可执行(exe)安装包，推荐安装和我相同的版本。进入<a href="https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.4.1/" target="_blank" rel="external">https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.4.1/</a> 下载 PyQt GPL v5.4.1 for Pythonv3.4(x64) 。注意到底是下载x86还是x64请根据自己系统的位数决定，这里需要注意的是：<strong>Python版本的位数需要跟系统保持一致，也就是如果你是64位系统，请一定要安装64位的Python</strong></p>
<p>关于Python版本：</p>
<p>我之前使用的是Python3.5，然后知道引用pyqt库时会一直出错，最后发现Python3.5和PyQt5好像是不兼容的，因为从上面的链接<a href="https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.4.1/" target="_blank" rel="external">https://sourceforge.net/projects/pyqt/files/PyQt5/PyQt-5.4.1/</a>，打开网址就可以看到，人家只适配了Python 3.4版本的，所以乖乖的降级使用吧~</p>
<h4 id="2-1-2-Linux平台"><a href="#2-1-2-Linux平台" class="headerlink" title="2.1.2 Linux平台"></a>2.1.2 Linux平台</h4><p>如果 Linux 中默认的 python 3 为 3.5 版本，可以通过以下指令切换到 3.4 。</p>
<pre><code>$ sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.4 70 --slave /usr/bin/python3m python3m /usr/bin/python3.4m
</code></pre><p>安装 PyQt5 。</p>
<pre><code>$ sudo apt-get install python3-pyqt5
</code></pre><p>安装完成之后，立马进入 Python 命令行交互界面测试是否正确安装。</p>
<pre><code>&gt;&gt;&gt; import PyQt5
</code></pre><p>如果执行以上的命令没有任何提示，说明成功安装。</p>
<h3 id="2-2-requests库安装"><a href="#2-2-requests库安装" class="headerlink" title="2.2 requests库安装"></a>2.2 requests库安装</h3><p>在cmd命令行中输入 <code>pip install requests</code></p>
<h3 id="2-3-datetime库"><a href="#2-3-datetime库" class="headerlink" title="2.3 datetime库"></a>2.3 datetime库</h3><p>datetime库不用安装，是Python自带的</p>
<h3 id="2-4-BeautifulSoup库"><a href="#2-4-BeautifulSoup库" class="headerlink" title="2.4 BeautifulSoup库"></a>2.4 BeautifulSoup库</h3><pre><code>pip install bs4
</code></pre><h2 id="三、编程实现"><a href="#三、编程实现" class="headerlink" title="三、编程实现"></a>三、编程实现</h2><h3 id="3-1-datetime使用"><a href="#3-1-datetime使用" class="headerlink" title="3.1 datetime使用"></a>3.1 datetime使用</h3><p>因为要计算倒计时，所以需要知道今天的日期，而且要计算两个日期之前有多少天。</p>
<p><strong>获取当前时间</strong></p>
<pre><code>from datetime import date
now = date.today()
print(now.strftime(&quot;%Y-%m-%d&quot;))
</code></pre><p><strong>获取日期差</strong></p>
<pre><code>from datetime import date
now = date.today()
chunjie = date(2017,1,28)  #春节的日期
chazhi = chunjie - now     #相差时间
print(chazhi.days)         #只需要知道相差时间的天数
</code></pre><p>现在只要的datetime的这两个用法就够了，其他的如果有兴趣可以去 <a href="http://www.wklken.me/posts/2015/03/03/python-base-datetime.html#1-datetime" target="_blank" rel="external">这里</a> 查看。</p>
<h3 id="3-2-requests库"><a href="#3-2-requests库" class="headerlink" title="3.2 requests库"></a>3.2 requests库</h3><p>因为我们要计算节日倒计时必须要知道今年哪些天是节日，而且节日数目比较多，程序员总不能一个个地手动添加到程序中吧，所以我们选择一个可以看到全年节日的网站<a href="http://tools.2345.com/jieri.htm" target="_blank" rel="external">http://tools.2345.com/jieri.htm</a> ，别看2345流氓软件一大堆，2345实用查询还是有点用的。</p>
<p>首先准备一个节日的Entity 类</p>
<pre><code>from datetime import date


class DayEntity(object):
    def __init__(self,dateStr,festival,type):
        self.dateStr = &quot;2017/&quot;+dateStr
        self.year = int(self.dateStr.split(&quot;/&quot;)[0])
        self.month = int(self.dateStr.split(&quot;/&quot;)[1])
        self.day = int(self.dateStr.split(&quot;/&quot;)[2])
        self.festival = festival
        self.type = type

    def getDate(self):
        d = date(self.year,self.month,self.day)
        return d

    def getDateString(self):
        return str(self.year)+&quot;年&quot;+str(self.month)+&quot;月&quot;+str(self.day)+&quot;日&quot;

    def getFestival(self):
        return self.festival

    def getType(self):
        return self.type
</code></pre><p>添加所有的节日，包括最后添加高考和考研日期</p>
<pre><code>result = requests.get(&quot;http://tools.2345.com/jieri.htm&quot;)
html_data = result.content.decode(&quot;gb2312&quot;)
soup = BeautifulSoup(html_data,&quot;html5lib&quot;)
year = soup.find(&quot;div&quot;,class_ = &quot;jieri&quot;)
clearfix = year.find_all(&quot;dl&quot;,class_=&quot;clearfix&quot;)
allFestival = list()

for month in clearfix:
    days = month.find(&quot;dd&quot;).find(&quot;ul&quot;).find_all(&quot;li&quot;)
    for day in days:
        a_tag = day.find(&quot;a&quot;)
        type = &quot;中国传统节日&quot;
        if &quot;cRed&quot; in str(a_tag[&quot;class&quot;]):
            type = &quot;中国传统节日&quot;
        elif &quot;cGreen&quot; in str(a_tag[&quot;class&quot;]):
            type = &quot;公众 / 国际节日&quot;
        elif &quot;cBlue&quot; in str(a_tag[&quot;class&quot;]):
            type = &quot;24节气&quot;
        else:
            type = &quot;中国传统节日&quot;
        dayEntity = DayEntity(day.text.split(&quot;[&quot;)[1][:-1],day.text.split(&quot;[&quot;)[0],type)
        allFestival.append(dayEntity)

allFestival.append(DayEntity(&quot;6/7&quot;,&quot;2017高考&quot;,&quot;中国传统节日&quot;))
allFestival.append(DayEntity(&quot;12/24&quot;, &quot;2017考研&quot;, &quot;中国传统节日&quot;))
</code></pre><h3 id="3-3-Qt界面"><a href="#3-3-Qt界面" class="headerlink" title="3.3 Qt界面"></a>3.3 Qt界面</h3><p>最终要做出来的程序是需要有界面的，而不是终端中显示结果，所以需要使用Qt进行界面设计。</p>
<h4 id="3-3-1-Pycharm中PyQt5的配置"><a href="#3-3-1-Pycharm中PyQt5的配置" class="headerlink" title="3.3.1 Pycharm中PyQt5的配置"></a>3.3.1 Pycharm中PyQt5的配置</h4><p>主要是添加三个External Tool,具体添加教程可以参考 <a href="http://blog.csdn.net/a359680405/article/details/45074761" target="_blank" rel="external">http://blog.csdn.net/a359680405/article/details/45074761</a></p>
<h4 id="3-3-2-使用QtDesigner-设计界面"><a href="#3-3-2-使用QtDesigner-设计界面" class="headerlink" title="3.3.2 使用QtDesigner 设计界面"></a>3.3.2 使用QtDesigner 设计界面</h4><p>在项目名上右键选择external tool打开<code>qtdesiginer</code> .</p>
<p><img src="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_55_39_qtdesigner.png" alt=""></p>
<p> 这是图形化设计界面的工具，可以直接在窗口中拖动控件，并会保存为.ui格式。如图所示，设计界面。</p>
<p><img src="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_58_33_jiemian.png" alt=""></p>
<p>对象结构如下所示：</p>
<p><img src="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_14_57_44_jiegou.png" alt=""></p>
<p>保存文件，生成的文件形如 <code>window.ui</code> .</p>
<h4 id="3-3-3-使用QtDesigner-设计界面"><a href="#3-3-3-使用QtDesigner-设计界面" class="headerlink" title="3.3.3 使用QtDesigner 设计界面"></a>3.3.3 使用QtDesigner 设计界面</h4><p>在生成的 <code>window.ui</code> 上右键，选择external tool中的PyUIC,然后会自动生成window.py文件，打开后可以看到，里面是UI的程序。</p>
<h4 id="3-3-4-打包资源"><a href="#3-3-4-打包资源" class="headerlink" title="3.3.4 打包资源"></a>3.3.4 打包资源</h4><p>需要注意的是，如果程序中使用到了图片资源，虽然可以直接引用图片的资源文件，如下面的代码：</p>
<pre><code>self.buttonList[i].setStyleSheet(&quot;background-image:url(checked.png)&quot;)
</code></pre><p><code>checked.png</code> 是放在项目根目录下的一个图片资源，直接运行是没有问题的，但是如果打包程序，在生成的dist文件夹中只有exe文件，并没有<code>checked.png</code>资源，运行就会没有效果甚至出错，当然你可以把图片复制到dist文件中，但是如果图片很多呢？而且也不便于传播，一个完整exe程序，双击打开就能用是最好的。</p>
<p>所以就需要使用qt的资源包，在qtdesigner中右下角的资源浏览器中，点击“铅笔”图标，添加资源文件。然后点击新建资源文件（弹出的对话框中有6个图标，第一个是新建资源文件），然后点击添加新前缀，取个名字如button,然后选中刚刚新建的button这个前缀，添加文件（倒数第二个图标），这样把需要用到的图标添加进去，可以自己根据需要调整分类。添加好之后的资源文件形如下图：</p>
<p><img src="http://7bvaky.com2.z0.glb.qiniucdn.com/2017-01-09_15_12_14_ziyuan.png" alt=""></p>
<h4 id="3-3-5-显示窗口"><a href="#3-3-5-显示窗口" class="headerlink" title="3.3.5 显示窗口"></a>3.3.5 显示窗口</h4><p>在主入口文件中 定义一个窗口类。</p>
<pre><code>class MainWindow(QMainWindow):
    def __init__(self,allFestival,parent = None):
        QMainWindow.__init__(self,parent)
        self.ui = Ui_mainWindow()
        self.ui.setupUi(self)
        self.ui.setFestivalList(allFestival)
        for festival in allFestival:
            text = festival.getFestival()+&quot;\n&quot;+festival.getDateString()
            left_date = festival.getDate() - now
            if left_date.days &gt; 0  and left_date.days &lt; 30 and festival.getType() != &quot;公众 / 国际节日&quot;:
                self.ui.addWidgetIntoGridLayout(text,True)
            else:
                self.ui.addWidgetIntoGridLayout(text, False)

app = QApplication(sys.argv)
mainWindow = MainWindow(allFestival)
mainWindow.show()
app.exec_()
</code></pre><p>其中addWidgetIntoGridLayout是我自己在Window.py中添加的一个函数，主要目的是动态添加一个按钮到GridLayout中</p>
<pre><code>def addWidgetIntoGridLayout(self,text,state):
    button = QtWidgets.QPushButton(text)

    if self.currentColumn &lt; self.maxColumn - 1:
        self.currentColumn = self.currentColumn + 1
    else:
        self.currentRow = self.currentRow + 1
        self.currentColumn = 0
    if state:
        button.setStyleSheet(&quot;background-image:url(:checkbox/checked.png)&quot;)
    else:
        button.setStyleSheet(&quot;background-image:none&quot;)
    button.setObjectName(str(self.currentRow*self.maxColumn + self.currentColumn))
    button.clicked.connect(lambda: self.changeState(int(button.objectName())))
    self.buttonList.append(button)
    self.gridLayout.addWidget(button, self.currentRow, self.currentColumn)
    self.stateList.append(state)
</code></pre><h4 id="3-3-6-统计倒计时结果"><a href="#3-3-6-统计倒计时结果" class="headerlink" title="3.3.6 统计倒计时结果"></a>3.3.6 统计倒计时结果</h4><p>程序中使用了一个list来保存GridLayout中所有的按钮的状态，点击一次按钮时为选中状态，再点击一次就会变成非选中状态。<br>还是用了一个festivalList保存所有的节日信息。<br>点击计算倒计时按钮的时候，就会遍历这个list,如果button为选中状态，那么根据按钮的下标在festivalList查询中查询节日信息，从而计算倒计时时间，具体代码：</p>
<pre><code>def calculate(self):
    now = date.today()
    flag = True
    resultStr = &quot;今天是&quot;+str(now.year)+&quot;年&quot;+str(now.month)+&quot;月&quot;+str(now.day)+&quot;日，星期&quot;+self.getChineseStr(now.weekday())+&quot;。今天&quot;
    for i in range(len(self.stateList)):
        if self.stateList[i]:
            festival = self.festivalList[i]
            resultStr += &quot;距%s还有%d天,&quot;%(festival.getFestival(),(festival.getDate() - now).days)
        if now == self.festivalList[i].getDate() and flag:
            resultStr = &quot;今天是&quot; + str(now.year) + &quot;年&quot; + str(now.month) + &quot;月&quot; + str(
                now.day) + &quot;日，星期&quot; + self.getChineseStr(now.weekday()) + &quot;。今天是&quot;+self.festivalList[i].getFestival()+&quot;。今天&quot;
            flag = False
    resultStr = resultStr[:-1]+&quot;。&quot;
    self.textEdit.clear()
    self.textEdit.append(resultStr)
</code></pre><h2 id="四-程序发布"><a href="#四-程序发布" class="headerlink" title="四. 程序发布"></a>四. 程序发布</h2><h3 id="4-1-安装PyInstaller"><a href="#4-1-安装PyInstaller" class="headerlink" title="4.1 安装PyInstaller"></a>4.1 安装PyInstaller</h3><p>使用 <code>pip install pyinstaller</code>安装 PyInstaller.</p>
<h3 id="4-2-打包程序"><a href="#4-2-打包程序" class="headerlink" title="4.2 打包程序"></a>4.2 打包程序</h3><p>首先注意打包过程可能出现各种错误，先做好心理准备。</p>
<p>按照网络上的一般教程，使用pyqt库时候，一般是在主入口文件中添加，无论这个文件是否使用到，都需要导入以下库：</p>
<pre><code>from PyQt5.QtCore import *
from PyQt5.QtWidgets import *
from PyQt5.QtGui import *
</code></pre><p>但是这样，在我的机器上是无法成功打包程序的，经常之前大量的尝试和搜索，找到了解决方案，需要在上面的库之前再加上一行：</p>
<pre><code>from PyQt5 import *
</code></pre><p>告诉打包程序需要使用PyQt5.</p>
<p>打包命令使用  </p>
<pre><code>pyinstaller --hidden-import queue -F -w GetFestivalDate.py
</code></pre><p>其中<code>--hidden-import queue</code> 很重要，如果不加上，可以生成exe但是运行时会闪退。</p>
<ul>
<li>-F 代表生成一个整体exe文件.</li>
<li>-w 代表生成的是图形化程序，对应-c 代表控制台程序。</li>
</ul>
<p>然后在生成的dist文件夹下就能找到生成的exe文件了，赶紧双击打开试试吧。生成的exe是可以直接拷贝到其他电脑运行的，只是需要注意的是，如果运行的系统的位数需要和你打包程序时的系统一致。</p>
<h2 id="五-后记"><a href="#五-后记" class="headerlink" title="五.后记"></a>五.后记</h2><p>以上就是整个程序的开发过程，特记录下来，有两个目的，一个是希望后来的初学者不要步入这些坑了，另一个是帮助自己记录这些细节，方便以后查阅。</p>
<p>代码我上传到Github上了，欢迎大家Star her和 Follow me.</p>

        </div>
        
        <blockquote class="post-copyright">
    <div class="content">
        所有原创文章版权归orzangleli所有，转载需声明：<a href="/2017/01/07/2017-01-07_Python节日倒计时软件/" target="_blank" rel="external">http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/</a>
    </div>
    <footer>
        <a href="http://www.orzangleli.com">
            <img src="/assets/avatar.gif" alt="orzangleli">
            orzangleli
        </a>
    </footer>
</blockquote>
        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件/">软件</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&title=《Python节日倒计时软件》 — orzangleli&pic=http://www.orzangleli.com/assets/avatar.gif" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&title=《Python节日倒计时软件》 — orzangleli&source=华中科技大学 本科10级 硕士14级 一个热爱技术的宅~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Python节日倒计时软件》 — orzangleli&url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&via=http://www.orzangleli.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>   

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/12/29/2016-12-29_2016年度总结/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">2016年度总结.md</h4>
      </a>
    </div>
  
</nav>


            
    
<div class="duoshuo" id="comments">
	<div class="ds-thread" data-thread-key="2017-01-07_Python节日倒计时软件" data-title="Python节日倒计时软件" data-url="http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/"></div>
</div>
<script src="/js/embed.min.js?v=1.2.1"></script>
<script src="//cdn.bootcss.com/marked/0.3.6/marked.min.js" async="async"></script>
<script>
var duoshuoQuery = {short_name:'orzangleli', theme: 'none'}
</script>





</article>



</div>

  </main>
  <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false }</script>



<div class="global-share" id="globalShare">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&title=《Python节日倒计时软件》 — orzangleli&pic=http://www.orzangleli.com/assets/avatar.gif" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&title=《Python节日倒计时软件》 — orzangleli&source=华中科技大学 本科10级 硕士14级 一个热爱技术的宅~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Python节日倒计时软件》 — orzangleli&url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/&via=http://www.orzangleli.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="http://s.jiathis.com/qrcode.php?url=http://www.orzangleli.com/2017/01/07/2017-01-07_Python节日倒计时软件/" alt="微信分享二维码">
</div>




  <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script src="/js/main.min.js?v=1.2.1"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.2.1"></script>





<script src="//s95.cnzz.com/z_stat.php?id=1260851403&web_id=1260851403"></script>





</body>
</html>
